# to run define K3S_TOKEN, K3S_VERSION is optional, eg:
#   K3S_TOKEN=${RANDOM}${RANDOM}${RANDOM} docker-compose up

services:

  server:
    image: "rancher/k3s:latest"
    command: server
#    command: server --data-dir /my/custom/data
#    tmpfs:
#    - /run
#    - /var/run
#    ulimits:
#      nproc: 65535
#      nofile:
#        soft: 65535
#        hard: 65535
    privileged: true
#    restart: always
#    environment:
#    - K3S_TOKEN=${K3S_TOKEN:?err}
#    - K3S_KUBECONFIG_OUTPUT=/output/kubeconfig.yaml
#    - K3S_KUBECONFIG_MODE=666
#    volumes:
#    - k3s-server:/var/lib/rancher/k3s
#    - /home/su/.k3s-cache:/my/custom/data
    # This is just so that we get the kubeconfig file out
#    - ./config:/output
    ports:
    - 6443:6443  # Kubernetes API Server

  agent:
    image: "rancher/k3s:latest"
    command: agent
